package main

import (
    "fmt"
    "github.com/miekg/dns"
    "github.com/gomodule/redigo/redis"
)

func FlushToDB(Record ResponseStruct) bool {
    _,err := c.Do("HSET", record_number,"name", Record.Name, "ttl",Record.Rawttl, "class", Record.Rawclass, "type", Record.Rawrrtype, "reply", Record.Rawstr,"length",Record.Rawrdlength)
    domain_map[Record.Name] = append(domain_map[Record.Name],record_number)
    record_number++;
    if err != nil {
        checkError(err)
        return false
    }
    fmt.Println("Record inserted to Database!")
    return true
}


func EntryExists(domain string)bool{
    mod_dom := domain+"."
    if len(domain_map[mod_dom]) == 0{
        return false 
    }else{
        return true
    }
}


func ReturnWithAnswers(domain string)*dns.Msg{
    mod_dom := domain+"."
    fmt.Println("Here")
    var res = new(dns.Msg)
    res.MsgHdr.Response = true;
    res.MsgHdr.Rcode = 0; //No error handling :(
    for i,record_number := range domain_map[mod_dom]{
        var new_rr = new(dns.RR_Header)
        new_rr.Name,_ = redis.String(c.Do("HGET",record_number,"name"))
        new_rr.Rrtype,_ = uint16(redis.Int(c.Do("HGET",record_number,"type")))
        new_rr.Class,_ = redis.Int(c.Do("HGET",record_number,"class"))
        new_rr.Ttl,_ = redis.Int(c.Do("HGET",record_number,"ttl"))
        new_rr.Rdlength,_ = redis.Int(c.Do("HGET",record_number,"length"))

        new_rr_wrap := new(dns.RR)
        new_rr_wrap.Header() = &new_rr

        res.Answer = append(res.Answer,)
        fmt.Print(i)
    }
    return res
}
